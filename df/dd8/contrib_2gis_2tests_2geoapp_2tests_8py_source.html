<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>Django: dj16/lib/python2.7/site-packages/django/contrib/gis/tests/geoapp/tests.py Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Django
   &#160;<span id="projectnumber">1.6.10</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../namespaces.html"><span>Packages</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">tests.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="../../dd/d52/namespacedjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests.html">    1</a></span>&#160;<span class="keyword">from</span> __future__ <span class="keyword">import</span> absolute_import</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">import</span> re</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">from</span> <a class="code" href="../../df/df6/namespacedjango_1_1db.html">django.db</a> <span class="keyword">import</span> connection</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">from</span> <a class="code" href="../../d3/d12/namespacedjango_1_1contrib_1_1gis.html">django.contrib.gis</a> <span class="keyword">import</span> gdal</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">from</span> <a class="code" href="../../de/daf/namespacedjango_1_1contrib_1_1gis_1_1geos.html">django.contrib.gis.geos</a> <span class="keyword">import</span> HAS_GEOS</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">from</span> <a class="code" href="../../d1/d3d/namespacedjango_1_1contrib_1_1gis_1_1tests_1_1utils.html">django.contrib.gis.tests.utils</a> <span class="keyword">import</span> (</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    HAS_SPATIAL_DB, no_mysql, no_oracle, no_spatialite,</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    mysql, oracle, postgis, spatialite)</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">from</span> <a class="code" href="../../d6/d4c/namespacedjango_1_1test.html">django.test</a> <span class="keyword">import</span> TestCase</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keyword">from</span> <a class="code" href="../../da/d57/namespacedjango_1_1utils.html">django.utils</a> <span class="keyword">import</span> six, unittest</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">from</span> <a class="code" href="../../d7/ddc/namespacedjango_1_1utils_1_1unittest.html">django.utils.unittest</a> <span class="keyword">import</span> skipUnless</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="keywordflow">if</span> HAS_GEOS:</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    <span class="keyword">from</span> <a class="code" href="../../de/daf/namespacedjango_1_1contrib_1_1gis_1_1geos.html">django.contrib.gis.geos</a> <span class="keyword">import</span> (fromstr, GEOSGeometry,</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;        Point, LineString, LinearRing, Polygon, GeometryCollection)</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    <span class="keyword">from</span> .models <span class="keyword">import</span> Country, City, PennsylvaniaCity, State, Track</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keywordflow">if</span> HAS_GEOS <span class="keywordflow">and</span> <span class="keywordflow">not</span> spatialite:</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <span class="keyword">from</span> .models <span class="keyword">import</span> Feature, MinusOneSRID</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno"><a class="line" href="../../dd/d52/namespacedjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests.html#a3453fcc7624c80ae65cc95f9cc33eea4">   25</a></span>&#160;<span class="keyword">def </span><a class="code" href="../../dd/d52/namespacedjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests.html#a3453fcc7624c80ae65cc95f9cc33eea4">postgis_bug_version</a>():</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    spatial_version = getattr(connection.ops, <span class="stringliteral">&quot;spatial_version&quot;</span>, (0,0,0))</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="keywordflow">return</span> spatial_version <span class="keywordflow">and</span> (2, 0, 0) &lt;= spatial_version &lt;= (2, 0, 1)</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;@<a class="code" href="../../d6/dd5/namespacedjango_1_1utils_1_1unittest_1_1case.html#ac3f15fbae74f2de4b84110a900d8450b">skipUnless</a>(HAS_GEOS <span class="keywordflow">and</span> HAS_SPATIAL_DB, <span class="stringliteral">&quot;Geos and spatial db are required.&quot;</span>)</div>
<div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html">   31</a></span>&#160;<span class="keyword">class </span><a class="code" href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html">GeoModelTest</a>(TestCase):</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html#a91172ffcb726ea2d9f34a303d8ff3f8c">   33</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html#a91172ffcb726ea2d9f34a303d8ff3f8c">test_fixtures</a>(self):</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        <span class="stringliteral">&quot;Testing geographic model initialization from fixtures.&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        <span class="comment"># Ensuring that data was loaded from initial data fixtures.</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        self.assertEqual(2, Country.objects.count())</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        self.assertEqual(8, City.objects.count())</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        self.assertEqual(2, State.objects.count())</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html#aa83d16938dcdcd8acc988ab6c49c69a4">   40</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html#aa83d16938dcdcd8acc988ab6c49c69a4">test_proxy</a>(self):</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        <span class="stringliteral">&quot;Testing Lazy-Geometry support (using the GeometryProxy).&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        <span class="comment">## Testing on a Point</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        pnt = Point(0, 0)</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        nullcity = City(name=<span class="stringliteral">&#39;NullCity&#39;</span>, point=pnt)</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        nullcity.save()</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <span class="comment"># Making sure TypeError is thrown when trying to set with an</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        <span class="comment">#  incompatible type.</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        <span class="keywordflow">for</span> bad <span class="keywordflow">in</span> [5, 2.0, LineString((0, 0), (1, 1))]:</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;            <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                nullcity.point = bad</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;            <span class="keywordflow">except</span> TypeError:</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                self.fail(<span class="stringliteral">&#39;Should throw a TypeError&#39;</span>)</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <span class="comment"># Now setting with a compatible GEOS Geometry, saving, and ensuring</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="comment">#  the save took, notice no SRID is explicitly set.</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        new = Point(5, 23)</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        nullcity.point = new</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        <span class="comment"># Ensuring that the SRID is automatically set to that of the</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        <span class="comment">#  field after assignment, but before saving.</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        self.assertEqual(4326, nullcity.point.srid)</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        nullcity.save()</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="comment"># Ensuring the point was saved correctly after saving</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        self.assertEqual(new, City.objects.get(name=<span class="stringliteral">&#39;NullCity&#39;</span>).point)</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <span class="comment"># Setting the X and Y of the Point</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        nullcity.point.x = 23</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        nullcity.point.y = 5</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="comment"># Checking assignments pre &amp; post-save.</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        self.assertNotEqual(Point(23, 5), City.objects.get(name=<span class="stringliteral">&#39;NullCity&#39;</span>).point)</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        nullcity.save()</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        self.assertEqual(Point(23, 5), City.objects.get(name=<span class="stringliteral">&#39;NullCity&#39;</span>).point)</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        nullcity.delete()</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="comment">## Testing on a Polygon</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        shell = LinearRing((0, 0), (0, 100), (100, 100), (100, 0), (0, 0))</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        inner = LinearRing((40, 40), (40, 60), (60, 60), (60, 40), (40, 40))</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="comment"># Creating a State object using a built Polygon</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        ply = Polygon(shell, inner)</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        nullstate = State(name=<span class="stringliteral">&#39;NullState&#39;</span>, poly=ply)</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        self.assertEqual(4326, nullstate.poly.srid) <span class="comment"># SRID auto-set from None</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        nullstate.save()</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        ns = State.objects.get(name=<span class="stringliteral">&#39;NullState&#39;</span>)</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        self.assertEqual(ply, ns.poly)</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="comment"># Testing the `ogr` and `srs` lazy-geometry properties.</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="keywordflow">if</span> gdal.HAS_GDAL:</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            self.assertEqual(<span class="keyword">True</span>, isinstance(ns.poly.ogr, <a class="code" href="../../dd/d78/classdjango_1_1contrib_1_1gis_1_1gdal_1_1geometries_1_1_o_g_r_geometry.html">gdal.OGRGeometry</a>))</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            self.assertEqual(ns.poly.wkb, ns.poly.ogr.wkb)</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            self.assertEqual(<span class="keyword">True</span>, isinstance(ns.poly.srs, <a class="code" href="../../d7/dda/classdjango_1_1contrib_1_1gis_1_1gdal_1_1srs_1_1_spatial_reference.html">gdal.SpatialReference</a>))</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            self.assertEqual(<span class="stringliteral">&#39;WGS 84&#39;</span>, ns.poly.srs.name)</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <span class="comment"># Changing the interior ring on the poly attribute.</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        new_inner = LinearRing((30, 30), (30, 70), (70, 70), (70, 30), (30, 30))</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        ns.poly[1] = new_inner</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        ply[1] = new_inner</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        self.assertEqual(4326, ns.poly.srid)</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        ns.save()</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        self.assertEqual(ply, State.objects.get(name=<span class="stringliteral">&#39;NullState&#39;</span>).poly)</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        ns.delete()</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    @no_mysql</div>
<div class="line"><a name="l00109"></a><span class="lineno"><a class="line" href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html#af6e2eaa4ee34cd022ee1ea9116875f0c">  109</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html#af6e2eaa4ee34cd022ee1ea9116875f0c">test_lookup_insert_transform</a>(self):</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="stringliteral">&quot;Testing automatic transform for lookups and inserts.&quot;</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="comment"># San Antonio in &#39;WGS84&#39; (SRID 4326)</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        sa_4326 = <span class="stringliteral">&#39;POINT (-98.493183 29.424170)&#39;</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        wgs_pnt = <a class="code" href="../../df/d10/namespacedjango_1_1contrib_1_1gis_1_1geos_1_1factory.html#a07ad8dd2ccf181fd3dd033955cfc2c4c">fromstr</a>(sa_4326, srid=4326) <span class="comment"># Our reference point in WGS84</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <span class="comment"># Oracle doesn&#39;t have SRID 3084, using 41157.</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="keywordflow">if</span> oracle:</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            <span class="comment"># San Antonio in &#39;Texas 4205, Southern Zone (1983, meters)&#39; (SRID 41157)</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            <span class="comment"># Used the following Oracle SQL to get this value:</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            <span class="comment">#  SELECT SDO_UTIL.TO_WKTGEOMETRY(SDO_CS.TRANSFORM(SDO_GEOMETRY(&#39;POINT (-98.493183 29.424170)&#39;, 4326), 41157)) FROM DUAL;</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            nad_wkt  = <span class="stringliteral">&#39;POINT (300662.034646583 5416427.45974934)&#39;</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            nad_srid = 41157</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            <span class="comment"># San Antonio in &#39;NAD83(HARN) / Texas Centric Lambert Conformal&#39; (SRID 3084)</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            nad_wkt = <span class="stringliteral">&#39;POINT (1645978.362408288754523 6276356.025927528738976)&#39;</span> <span class="comment"># Used ogr.py in gdal 1.4.1 for this transform</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            nad_srid = 3084</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="comment"># Constructing &amp; querying with a point from a different SRID. Oracle</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="comment"># `SDO_OVERLAPBDYINTERSECT` operates differently from</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="comment"># `ST_Intersects`, so contains is used instead.</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        nad_pnt = <a class="code" href="../../df/d10/namespacedjango_1_1contrib_1_1gis_1_1geos_1_1factory.html#a07ad8dd2ccf181fd3dd033955cfc2c4c">fromstr</a>(nad_wkt, srid=nad_srid)</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="keywordflow">if</span> oracle:</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            tx = Country.objects.get(mpoly__contains=nad_pnt)</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            tx = Country.objects.get(mpoly__intersects=nad_pnt)</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        self.assertEqual(<span class="stringliteral">&#39;Texas&#39;</span>, tx.name)</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="comment"># Creating San Antonio.  Remember the Alamo.</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        sa = City.objects.create(name=<span class="stringliteral">&#39;San Antonio&#39;</span>, point=nad_pnt)</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="comment"># Now verifying that San Antonio was transformed correctly</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        sa = City.objects.get(name=<span class="stringliteral">&#39;San Antonio&#39;</span>)</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        self.assertAlmostEqual(wgs_pnt.x, sa.point.x, 6)</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        self.assertAlmostEqual(wgs_pnt.y, sa.point.y, 6)</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="comment"># If the GeometryField SRID is -1, then we shouldn&#39;t perform any</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="comment"># transformation if the SRID of the input geometry is different.</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="comment"># SpatiaLite does not support missing SRID values.</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> spatialite:</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            m1 = MinusOneSRID(geom=Point(17, 23, srid=4326))</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            m1.save()</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            self.assertEqual(-1, m1.geom.srid)</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div>
<div class="line"><a name="l00153"></a><span class="lineno"><a class="line" href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html#a094d3322a5fae4bf18d6ce5f253e3af2">  153</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html#a094d3322a5fae4bf18d6ce5f253e3af2">test_createnull</a>(self):</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="stringliteral">&quot;Testing creating a model instance and the geometry being None&quot;</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        c = City()</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        self.assertEqual(c.point, <span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    @no_spatialite <span class="comment"># SpatiaLite does not support abstract geometry columns</span></div>
<div class="line"><a name="l00159"></a><span class="lineno"><a class="line" href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html#a53b2472041f463fe9e839f1e9e423a02">  159</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html#a53b2472041f463fe9e839f1e9e423a02">test_geometryfield</a>(self):</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="stringliteral">&quot;Testing the general GeometryField.&quot;</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        Feature(name=<span class="stringliteral">&#39;Point&#39;</span>, geom=Point(1, 1)).save()</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        Feature(name=<span class="stringliteral">&#39;LineString&#39;</span>, geom=LineString((0, 0), (1, 1), (5, 5))).save()</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        Feature(name=<span class="stringliteral">&#39;Polygon&#39;</span>, geom=Polygon(LinearRing((0, 0), (0, 5), (5, 5), (5, 0), (0, 0)))).save()</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        Feature(name=<span class="stringliteral">&#39;GeometryCollection&#39;</span>,</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                geom=GeometryCollection(Point(2, 2), LineString((0, 0), (2, 2)),</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                                        Polygon(LinearRing((0, 0), (0, 5), (5, 5), (5, 0), (0, 0))))).save()</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        f_1 = Feature.objects.get(name=<span class="stringliteral">&#39;Point&#39;</span>)</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        self.assertEqual(<span class="keyword">True</span>, isinstance(f_1.geom, Point))</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        self.assertEqual((1.0, 1.0), f_1.geom.tuple)</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        f_2 = Feature.objects.get(name=<span class="stringliteral">&#39;LineString&#39;</span>)</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        self.assertEqual(<span class="keyword">True</span>, isinstance(f_2.geom, LineString))</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        self.assertEqual(((0.0, 0.0), (1.0, 1.0), (5.0, 5.0)), f_2.geom.tuple)</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        f_3 = Feature.objects.get(name=<span class="stringliteral">&#39;Polygon&#39;</span>)</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        self.assertEqual(<span class="keyword">True</span>, isinstance(f_3.geom, Polygon))</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        f_4 = Feature.objects.get(name=<span class="stringliteral">&#39;GeometryCollection&#39;</span>)</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        self.assertEqual(<span class="keyword">True</span>, isinstance(f_4.geom, GeometryCollection))</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        self.assertEqual(f_3.geom, f_4.geom[2])</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    @no_mysql</div>
<div class="line"><a name="l00182"></a><span class="lineno"><a class="line" href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html#abd3e3784904ec33e48e6ffdbc7a0e325">  182</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html#abd3e3784904ec33e48e6ffdbc7a0e325">test_inherited_geofields</a>(self):</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="stringliteral">&quot;Test GeoQuerySet methods on inherited Geometry fields.&quot;</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="comment"># Creating a Pennsylvanian city.</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        mansfield = PennsylvaniaCity.objects.create(name=<span class="stringliteral">&#39;Mansfield&#39;</span>, county=<span class="stringliteral">&#39;Tioga&#39;</span>, point=<span class="stringliteral">&#39;POINT(-77.071445 41.823881)&#39;</span>)</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="comment"># All transformation SQL will need to be performed on the</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="comment"># _parent_ table.</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        qs = PennsylvaniaCity.objects.transform(32128)</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        self.assertEqual(1, qs.count())</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="keywordflow">for</span> pc <span class="keywordflow">in</span> qs: self.assertEqual(32128, pc.point.srid)</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno"><a class="line" href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html#a56675db1c4056e56e173ca8340e88c6b">  194</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html#a56675db1c4056e56e173ca8340e88c6b">test_raw_sql_query</a>(self):</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="stringliteral">&quot;Testing raw SQL query.&quot;</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        cities1 = City.objects.all()</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <span class="comment"># Only PostGIS would support a &#39;select *&#39; query because of its recognized</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="comment"># HEXEWKB format for geometry fields</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        as_text = <span class="stringliteral">&#39;ST_AsText(%s)&#39;</span> <span class="keywordflow">if</span> postgis <span class="keywordflow">else</span> connection.ops.select</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        cities2 = City.objects.raw(</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <span class="stringliteral">&#39;select id, name, %s from geoapp_city&#39;</span> % as_text % <span class="stringliteral">&#39;point&#39;</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        )</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        self.assertEqual(len(cities1), len(list(cities2)))</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        self.assertTrue(isinstance(cities2[0].point, Point))</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;@<a class="code" href="../../d6/dd5/namespacedjango_1_1utils_1_1unittest_1_1case.html#ac3f15fbae74f2de4b84110a900d8450b">skipUnless</a>(HAS_GEOS <span class="keywordflow">and</span> HAS_SPATIAL_DB, <span class="stringliteral">&quot;Geos and spatial db are required.&quot;</span>)</div>
<div class="line"><a name="l00208"></a><span class="lineno"><a class="line" href="../../d9/d8c/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test.html">  208</a></span>&#160;<span class="keyword">class </span><a class="code" href="../../d9/d8c/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test.html">GeoLookupTest</a>(TestCase):</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    @no_mysql</div>
<div class="line"><a name="l00211"></a><span class="lineno"><a class="line" href="../../d9/d8c/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test.html#a0ab8d6a4d884a1bdc3882a113ff44817">  211</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../d9/d8c/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test.html#a0ab8d6a4d884a1bdc3882a113ff44817">test_disjoint_lookup</a>(self):</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="stringliteral">&quot;Testing the `disjoint` lookup type.&quot;</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        ptown = City.objects.get(name=<span class="stringliteral">&#39;Pueblo&#39;</span>)</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        qs1 = City.objects.filter(point__disjoint=ptown.point)</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        self.assertEqual(7, qs1.count())</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        qs2 = State.objects.filter(poly__disjoint=ptown.point)</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        self.assertEqual(1, qs2.count())</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        self.assertEqual(<span class="stringliteral">&#39;Kansas&#39;</span>, qs2[0].name)</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div>
<div class="line"><a name="l00221"></a><span class="lineno"><a class="line" href="../../d9/d8c/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test.html#a08b5edb217551dc50f72dce77c4531b1">  221</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../d9/d8c/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test.html#a08b5edb217551dc50f72dce77c4531b1">test_contains_contained_lookups</a>(self):</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="stringliteral">&quot;Testing the &#39;contained&#39;, &#39;contains&#39;, and &#39;bbcontains&#39; lookup types.&quot;</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="comment"># Getting Texas, yes we were a country -- once ;)</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        texas = Country.objects.get(name=<span class="stringliteral">&#39;Texas&#39;</span>)</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="comment"># Seeing what cities are in Texas, should get Houston and Dallas,</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="comment">#  and Oklahoma City because &#39;contained&#39; only checks on the</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="comment">#  _bounding box_ of the Geometries.</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> oracle:</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            qs = City.objects.filter(point__contained=texas.mpoly)</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            self.assertEqual(3, qs.count())</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            cities = [<span class="stringliteral">&#39;Houston&#39;</span>, <span class="stringliteral">&#39;Dallas&#39;</span>, <span class="stringliteral">&#39;Oklahoma City&#39;</span>]</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            <span class="keywordflow">for</span> c <span class="keywordflow">in</span> qs: self.assertEqual(<span class="keyword">True</span>, c.name <span class="keywordflow">in</span> cities)</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="comment"># Pulling out some cities.</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        houston = City.objects.get(name=<span class="stringliteral">&#39;Houston&#39;</span>)</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        wellington = City.objects.get(name=<span class="stringliteral">&#39;Wellington&#39;</span>)</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        pueblo = City.objects.get(name=<span class="stringliteral">&#39;Pueblo&#39;</span>)</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        okcity = City.objects.get(name=<span class="stringliteral">&#39;Oklahoma City&#39;</span>)</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        lawrence = City.objects.get(name=<span class="stringliteral">&#39;Lawrence&#39;</span>)</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="comment"># Now testing contains on the countries using the points for</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <span class="comment">#  Houston and Wellington.</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        tx = Country.objects.get(mpoly__contains=houston.point) <span class="comment"># Query w/GEOSGeometry</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        nz = Country.objects.get(mpoly__contains=wellington.point.hex) <span class="comment"># Query w/EWKBHEX</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        self.assertEqual(<span class="stringliteral">&#39;Texas&#39;</span>, tx.name)</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        self.assertEqual(<span class="stringliteral">&#39;New Zealand&#39;</span>, nz.name)</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="comment"># Spatialite 2.3 thinks that Lawrence is in Puerto Rico (a NULL geometry).</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> spatialite:</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            ks = State.objects.get(poly__contains=lawrence.point)</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            self.assertEqual(<span class="stringliteral">&#39;Kansas&#39;</span>, ks.name)</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="comment"># Pueblo and Oklahoma City (even though OK City is within the bounding box of Texas)</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="comment"># are not contained in Texas or New Zealand.</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        self.assertEqual(0, len(Country.objects.filter(mpoly__contains=pueblo.point))) <span class="comment"># Query w/GEOSGeometry object</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        self.assertEqual((mysql <span class="keywordflow">and</span> 1) <span class="keywordflow">or</span> 0,</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                         len(Country.objects.filter(mpoly__contains=okcity.point.wkt))) <span class="comment"># Qeury w/WKT</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="comment"># OK City is contained w/in bounding box of Texas.</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> oracle:</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            qs = Country.objects.filter(mpoly__bbcontains=okcity.point)</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            self.assertEqual(1, len(qs))</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            self.assertEqual(<span class="stringliteral">&#39;Texas&#39;</span>, qs[0].name)</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="comment"># Only PostGIS has `left` and `right` lookup types.</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    @no_mysql</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    @no_oracle</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    @no_spatialite</div>
<div class="line"><a name="l00270"></a><span class="lineno"><a class="line" href="../../d9/d8c/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test.html#a988ddabf648f03b670285cd8408b0229">  270</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../d9/d8c/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test.html#a94eba618cf6c64a591472f53b0b1d540">test_left_right_lookups</a>(self):</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="stringliteral">&quot;Testing the &#39;left&#39; and &#39;right&#39; lookup types.&quot;</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <span class="comment"># Left: A &lt;&lt; B =&gt; true if xmax(A) &lt; xmin(B)</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <span class="comment"># Right: A &gt;&gt; B =&gt; true if xmin(A) &gt; xmax(B)</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <span class="comment"># See: BOX2D_left() and BOX2D_right() in lwgeom_box2dfloat4.c in PostGIS source.</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <span class="comment"># Getting the borders for Colorado &amp; Kansas</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        co_border = State.objects.get(name=<span class="stringliteral">&#39;Colorado&#39;</span>).poly</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        ks_border = State.objects.get(name=<span class="stringliteral">&#39;Kansas&#39;</span>).poly</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <span class="comment"># Note: Wellington has an &#39;X&#39; value of 174, so it will not be considered</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="comment"># to the left of CO.</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="comment"># These cities should be strictly to the right of the CO border.</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        cities = [<span class="stringliteral">&#39;Houston&#39;</span>, <span class="stringliteral">&#39;Dallas&#39;</span>, <span class="stringliteral">&#39;Oklahoma City&#39;</span>,</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                  <span class="stringliteral">&#39;Lawrence&#39;</span>, <span class="stringliteral">&#39;Chicago&#39;</span>, <span class="stringliteral">&#39;Wellington&#39;</span>]</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        qs = City.objects.filter(point__right=co_border)</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        self.assertEqual(6, len(qs))</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="keywordflow">for</span> c <span class="keywordflow">in</span> qs: self.assertEqual(<span class="keyword">True</span>, c.name <span class="keywordflow">in</span> cities)</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <span class="comment"># These cities should be strictly to the right of the KS border.</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        cities = [<span class="stringliteral">&#39;Chicago&#39;</span>, <span class="stringliteral">&#39;Wellington&#39;</span>]</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        qs = City.objects.filter(point__right=ks_border)</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        self.assertEqual(2, len(qs))</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="keywordflow">for</span> c <span class="keywordflow">in</span> qs: self.assertEqual(<span class="keyword">True</span>, c.name <span class="keywordflow">in</span> cities)</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="comment"># Note: Wellington has an &#39;X&#39; value of 174, so it will not be considered</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="comment">#  to the left of CO.</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        vic = City.objects.get(point__left=co_border)</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        self.assertEqual(<span class="stringliteral">&#39;Victoria&#39;</span>, vic.name)</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        cities = [<span class="stringliteral">&#39;Pueblo&#39;</span>, <span class="stringliteral">&#39;Victoria&#39;</span>]</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        qs = City.objects.filter(point__left=ks_border)</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        self.assertEqual(2, len(qs))</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keywordflow">for</span> c <span class="keywordflow">in</span> qs: self.assertEqual(<span class="keyword">True</span>, c.name <span class="keywordflow">in</span> cities)</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="comment"># The left/right lookup tests are known failures on PostGIS 2.0/2.0.1</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="comment"># http://trac.osgeo.org/postgis/ticket/2035</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordflow">if</span> <a class="code" href="../../dd/d52/namespacedjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests.html#a3453fcc7624c80ae65cc95f9cc33eea4">postgis_bug_version</a>():</div>
<div class="line"><a name="l00309"></a><span class="lineno"><a class="line" href="../../d9/d8c/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test.html#a94eba618cf6c64a591472f53b0b1d540">  309</a></span>&#160;        test_left_right_lookups = unittest.expectedFailure(test_left_right_lookups)</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div>
<div class="line"><a name="l00311"></a><span class="lineno"><a class="line" href="../../d9/d8c/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test.html#a47e931cd43ee4f96a1f0f947515b1c06">  311</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../d9/d8c/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test.html#a47e931cd43ee4f96a1f0f947515b1c06">test_equals_lookups</a>(self):</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="stringliteral">&quot;Testing the &#39;same_as&#39; and &#39;equals&#39; lookup types.&quot;</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        pnt = <a class="code" href="../../df/d10/namespacedjango_1_1contrib_1_1gis_1_1geos_1_1factory.html#a07ad8dd2ccf181fd3dd033955cfc2c4c">fromstr</a>(<span class="stringliteral">&#39;POINT (-95.363151 29.763374)&#39;</span>, srid=4326)</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        c1 = City.objects.get(point=pnt)</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        c2 = City.objects.get(point__same_as=pnt)</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        c3 = City.objects.get(point__equals=pnt)</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="keywordflow">for</span> c <span class="keywordflow">in</span> [c1, c2, c3]: self.assertEqual(<span class="stringliteral">&#39;Houston&#39;</span>, c.name)</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    @no_mysql</div>
<div class="line"><a name="l00320"></a><span class="lineno"><a class="line" href="../../d9/d8c/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test.html#aeea453266cbe994306c97983c62c3b11">  320</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../d9/d8c/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test.html#aeea453266cbe994306c97983c62c3b11">test_null_geometries</a>(self):</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="stringliteral">&quot;Testing NULL geometry support, and the `isnull` lookup type.&quot;</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <span class="comment"># Creating a state with a NULL boundary.</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        State.objects.create(name=<span class="stringliteral">&#39;Puerto Rico&#39;</span>)</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="comment"># Querying for both NULL and Non-NULL values.</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        nullqs = State.objects.filter(poly__isnull=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        validqs = State.objects.filter(poly__isnull=<span class="keyword">False</span>)</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="comment"># Puerto Rico should be NULL (it&#39;s a commonwealth unincorporated territory)</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        self.assertEqual(1, len(nullqs))</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        self.assertEqual(<span class="stringliteral">&#39;Puerto Rico&#39;</span>, nullqs[0].name)</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="comment"># The valid states should be Colorado &amp; Kansas</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        self.assertEqual(2, len(validqs))</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        state_names = [s.name <span class="keywordflow">for</span> s <span class="keywordflow">in</span> validqs]</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        self.assertEqual(<span class="keyword">True</span>, <span class="stringliteral">&#39;Colorado&#39;</span> <span class="keywordflow">in</span> state_names)</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        self.assertEqual(<span class="keyword">True</span>, <span class="stringliteral">&#39;Kansas&#39;</span> <span class="keywordflow">in</span> state_names)</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <span class="comment"># Saving another commonwealth w/a NULL geometry.</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        nmi = State.objects.create(name=<span class="stringliteral">&#39;Northern Mariana Islands&#39;</span>, poly=<span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        self.assertEqual(nmi.poly, <span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <span class="comment"># Assigning a geomery and saving -- then UPDATE back to NULL.</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        nmi.poly = <span class="stringliteral">&#39;POLYGON((0 0,1 0,1 1,1 0,0 0))&#39;</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        nmi.save()</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        State.objects.filter(name=<span class="stringliteral">&#39;Northern Mariana Islands&#39;</span>).update(poly=<span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        self.assertEqual(<span class="keywordtype">None</span>, State.objects.get(name=<span class="stringliteral">&#39;Northern Mariana Islands&#39;</span>).poly)</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    @no_mysql</div>
<div class="line"><a name="l00350"></a><span class="lineno"><a class="line" href="../../d9/d8c/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test.html#a98ffb8f3bc734a4b8120415786705350">  350</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../d9/d8c/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test.html#a98ffb8f3bc734a4b8120415786705350">test_relate_lookup</a>(self):</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        <span class="stringliteral">&quot;Testing the &#39;relate&#39; lookup type.&quot;</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <span class="comment"># To make things more interesting, we will have our Texas reference point in</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="comment"># different SRIDs.</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        pnt1 = <a class="code" href="../../df/d10/namespacedjango_1_1contrib_1_1gis_1_1geos_1_1factory.html#a07ad8dd2ccf181fd3dd033955cfc2c4c">fromstr</a>(<span class="stringliteral">&#39;POINT (649287.0363174 4177429.4494686)&#39;</span>, srid=2847)</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        pnt2 = <a class="code" href="../../df/d10/namespacedjango_1_1contrib_1_1gis_1_1geos_1_1factory.html#a07ad8dd2ccf181fd3dd033955cfc2c4c">fromstr</a>(<span class="stringliteral">&#39;POINT(-98.4919715741052 29.4333344025053)&#39;</span>, srid=4326)</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="comment"># Not passing in a geometry as first param shoud</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <span class="comment"># raise a type error when initializing the GeoQuerySet</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        self.assertRaises(ValueError, Country.objects.filter, mpoly__relate=(23, <span class="stringliteral">&#39;foo&#39;</span>))</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        <span class="comment"># Making sure the right exception is raised for the given</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="comment"># bad arguments.</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <span class="keywordflow">for</span> bad_args, e <span class="keywordflow">in</span> [((pnt1, 0), ValueError), ((pnt2, <span class="stringliteral">&#39;T*T***FF*&#39;</span>, 0), ValueError)]:</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            qs = Country.objects.filter(mpoly__relate=bad_args)</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            self.assertRaises(e, qs.count)</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="comment"># Relate works differently for the different backends.</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="keywordflow">if</span> postgis <span class="keywordflow">or</span> spatialite:</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            contains_mask = <span class="stringliteral">&#39;T*T***FF*&#39;</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            within_mask = <span class="stringliteral">&#39;T*F**F***&#39;</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            intersects_mask = <span class="stringliteral">&#39;T********&#39;</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <span class="keywordflow">elif</span> oracle:</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            contains_mask = <span class="stringliteral">&#39;contains&#39;</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            within_mask = <span class="stringliteral">&#39;inside&#39;</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            <span class="comment"># TODO: This is not quite the same as the PostGIS mask above</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            intersects_mask = <span class="stringliteral">&#39;overlapbdyintersect&#39;</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <span class="comment"># Testing contains relation mask.</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        self.assertEqual(<span class="stringliteral">&#39;Texas&#39;</span>, Country.objects.get(mpoly__relate=(pnt1, contains_mask)).name)</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        self.assertEqual(<span class="stringliteral">&#39;Texas&#39;</span>, Country.objects.get(mpoly__relate=(pnt2, contains_mask)).name)</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <span class="comment"># Testing within relation mask.</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        ks = State.objects.get(name=<span class="stringliteral">&#39;Kansas&#39;</span>)</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        self.assertEqual(<span class="stringliteral">&#39;Lawrence&#39;</span>, City.objects.get(point__relate=(ks.poly, within_mask)).name)</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <span class="comment"># Testing intersection relation mask.</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> oracle:</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            self.assertEqual(<span class="stringliteral">&#39;Texas&#39;</span>, Country.objects.get(mpoly__relate=(pnt1, intersects_mask)).name)</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            self.assertEqual(<span class="stringliteral">&#39;Texas&#39;</span>, Country.objects.get(mpoly__relate=(pnt2, intersects_mask)).name)</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            self.assertEqual(<span class="stringliteral">&#39;Lawrence&#39;</span>, City.objects.get(point__relate=(ks.poly, intersects_mask)).name)</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;@<a class="code" href="../../d6/dd5/namespacedjango_1_1utils_1_1unittest_1_1case.html#ac3f15fbae74f2de4b84110a900d8450b">skipUnless</a>(HAS_GEOS <span class="keywordflow">and</span> HAS_SPATIAL_DB, <span class="stringliteral">&quot;Geos and spatial db are required.&quot;</span>)</div>
<div class="line"><a name="l00394"></a><span class="lineno"><a class="line" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html">  394</a></span>&#160;<span class="keyword">class </span><a class="code" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html">GeoQuerySetTest</a>(TestCase):</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="comment"># Please keep the tests in GeoQuerySet method&#39;s alphabetic order</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    @no_mysql</div>
<div class="line"><a name="l00398"></a><span class="lineno"><a class="line" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#a3976553a39d24acd960d3554aff8dd36">  398</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#a3976553a39d24acd960d3554aff8dd36">test_centroid</a>(self):</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="stringliteral">&quot;Testing the `centroid` GeoQuerySet method.&quot;</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        qs = State.objects.exclude(poly__isnull=<span class="keyword">True</span>).centroid()</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        <span class="keywordflow">if</span> oracle:</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            tol = 0.1</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        <span class="keywordflow">elif</span> spatialite:</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            tol = 0.000001</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            tol = 0.000000001</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="keywordflow">for</span> s <span class="keywordflow">in</span> qs:</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            self.assertEqual(<span class="keyword">True</span>, s.poly.centroid.equals_exact(s.centroid, tol))</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    @no_mysql</div>
<div class="line"><a name="l00411"></a><span class="lineno"><a class="line" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#a1d401d2c4d0e51b0a9bee2968246dc35">  411</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#a1d401d2c4d0e51b0a9bee2968246dc35">test_diff_intersection_union</a>(self):</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <span class="stringliteral">&quot;Testing the `difference`, `intersection`, `sym_difference`, and `union` GeoQuerySet methods.&quot;</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        geom = Point(5, 23)</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        tol = 1</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        qs = Country.objects.all().difference(geom).sym_difference(geom).union(geom)</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <span class="comment"># XXX For some reason SpatiaLite does something screwey with the Texas geometry here.  Also,</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="comment"># XXX it doesn&#39;t like the null intersection.</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <span class="keywordflow">if</span> spatialite:</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            qs = qs.exclude(name=<span class="stringliteral">&#39;Texas&#39;</span>)</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            qs = qs.intersection(geom)</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        <span class="keywordflow">for</span> c <span class="keywordflow">in</span> qs:</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            <span class="keywordflow">if</span> oracle:</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                <span class="comment"># Should be able to execute the queries; however, they won&#39;t be the same</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                <span class="comment"># as GEOS (because Oracle doesn&#39;t use GEOS internally like PostGIS or</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                <span class="comment"># SpatiaLite).</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                self.assertEqual(c.mpoly.difference(geom), c.difference)</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                <span class="keywordflow">if</span> <span class="keywordflow">not</span> spatialite:</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                    self.assertEqual(c.mpoly.intersection(geom), c.intersection)</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                self.assertEqual(c.mpoly.sym_difference(geom), c.sym_difference)</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                self.assertEqual(c.mpoly.union(geom), c.union)</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    @no_mysql</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    @no_spatialite <span class="comment"># SpatiaLite does not have an Extent function</span></div>
<div class="line"><a name="l00439"></a><span class="lineno"><a class="line" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#aae0bb17cd7adc32d938889c48bdd1214">  439</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#aae0bb17cd7adc32d938889c48bdd1214">test_extent</a>(self):</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        <span class="stringliteral">&quot;Testing the `extent` GeoQuerySet method.&quot;</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="comment"># Reference query:</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <span class="comment"># `SELECT ST_extent(point) FROM geoapp_city WHERE (name=&#39;Houston&#39; or name=&#39;Dallas&#39;);`</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="comment">#   =&gt;  BOX(-96.8016128540039 29.7633724212646,-95.3631439208984 32.7820587158203)</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        expected = (-96.8016128540039, 29.7633724212646, -95.3631439208984, 32.782058715820)</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        qs = City.objects.filter(name__in=(<span class="stringliteral">&#39;Houston&#39;</span>, <span class="stringliteral">&#39;Dallas&#39;</span>))</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        extent = qs.extent()</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        <span class="keywordflow">for</span> val, exp <span class="keywordflow">in</span> zip(extent, expected):</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            self.assertAlmostEqual(exp, val, 4)</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    @no_mysql</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    @no_oracle</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    @no_spatialite</div>
<div class="line"><a name="l00455"></a><span class="lineno"><a class="line" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#aeb75fa45b03442ce2ae9caa0a24595cf">  455</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#aeb75fa45b03442ce2ae9caa0a24595cf">test_force_rhr</a>(self):</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        <span class="stringliteral">&quot;Testing GeoQuerySet.force_rhr().&quot;</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        rings = ( ( (0, 0), (5, 0), (0, 5), (0, 0) ),</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                  ( (1, 1), (1, 3), (3, 1), (1, 1) ),</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                  )</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        rhr_rings = ( ( (0, 0), (0, 5), (5, 0), (0, 0) ),</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                      ( (1, 1), (3, 1), (1, 3), (1, 1) ),</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                      )</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        State.objects.create(name=<span class="stringliteral">&#39;Foo&#39;</span>, poly=Polygon(*rings))</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        s = State.objects.force_rhr().get(name=<span class="stringliteral">&#39;Foo&#39;</span>)</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        self.assertEqual(rhr_rings, s.force_rhr.coords)</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    @no_mysql</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    @no_oracle</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    @no_spatialite</div>
<div class="line"><a name="l00470"></a><span class="lineno"><a class="line" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#abea4956cd9d79668eb119ac5a871321d">  470</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#abea4956cd9d79668eb119ac5a871321d">test_geohash</a>(self):</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="stringliteral">&quot;Testing GeoQuerySet.geohash().&quot;</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> connection.ops.geohash: <span class="keywordflow">return</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <span class="comment"># Reference query:</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        <span class="comment"># SELECT ST_GeoHash(point) FROM geoapp_city WHERE name=&#39;Houston&#39;;</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="comment"># SELECT ST_GeoHash(point, 5) FROM geoapp_city WHERE name=&#39;Houston&#39;;</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        ref_hash = <span class="stringliteral">&#39;9vk1mfq8jx0c8e0386z6&#39;</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        h1 = City.objects.geohash().get(name=<span class="stringliteral">&#39;Houston&#39;</span>)</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        h2 = City.objects.geohash(precision=5).get(name=<span class="stringliteral">&#39;Houston&#39;</span>)</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        self.assertEqual(ref_hash, h1.geohash)</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        self.assertEqual(ref_hash[:5], h2.geohash)</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div>
<div class="line"><a name="l00482"></a><span class="lineno"><a class="line" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#a4c5f497ce9675b81c7384ab9bd3df982">  482</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#a4c5f497ce9675b81c7384ab9bd3df982">test_geojson</a>(self):</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="stringliteral">&quot;Testing GeoJSON output from the database using GeoQuerySet.geojson().&quot;</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        <span class="comment"># Only PostGIS 1.3.4+ and SpatiaLite 3.0+ support GeoJSON.</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> connection.ops.geojson:</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            self.assertRaises(NotImplementedError, Country.objects.all().geojson, field_name=<span class="stringliteral">&#39;mpoly&#39;</span>)</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            <span class="keywordflow">return</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        pueblo_json = <span class="stringliteral">&#39;{&quot;type&quot;:&quot;Point&quot;,&quot;coordinates&quot;:[-104.609252,38.255001]}&#39;</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        houston_json = <span class="stringliteral">&#39;{&quot;type&quot;:&quot;Point&quot;,&quot;crs&quot;:{&quot;type&quot;:&quot;name&quot;,&quot;properties&quot;:{&quot;name&quot;:&quot;EPSG:4326&quot;}},&quot;coordinates&quot;:[-95.363151,29.763374]}&#39;</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        victoria_json = <span class="stringliteral">&#39;{&quot;type&quot;:&quot;Point&quot;,&quot;bbox&quot;:[-123.30519600,48.46261100,-123.30519600,48.46261100],&quot;coordinates&quot;:[-123.305196,48.462611]}&#39;</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        chicago_json = <span class="stringliteral">&#39;{&quot;type&quot;:&quot;Point&quot;,&quot;crs&quot;:{&quot;type&quot;:&quot;name&quot;,&quot;properties&quot;:{&quot;name&quot;:&quot;EPSG:4326&quot;}},&quot;bbox&quot;:[-87.65018,41.85039,-87.65018,41.85039],&quot;coordinates&quot;:[-87.65018,41.85039]}&#39;</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <span class="keywordflow">if</span> postgis <span class="keywordflow">and</span> connection.ops.spatial_version &lt; (1, 4, 0):</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;            pueblo_json = <span class="stringliteral">&#39;{&quot;type&quot;:&quot;Point&quot;,&quot;coordinates&quot;:[-104.60925200,38.25500100]}&#39;</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            houston_json = <span class="stringliteral">&#39;{&quot;type&quot;:&quot;Point&quot;,&quot;crs&quot;:{&quot;type&quot;:&quot;EPSG&quot;,&quot;properties&quot;:{&quot;EPSG&quot;:4326}},&quot;coordinates&quot;:[-95.36315100,29.76337400]}&#39;</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            victoria_json = <span class="stringliteral">&#39;{&quot;type&quot;:&quot;Point&quot;,&quot;bbox&quot;:[-123.30519600,48.46261100,-123.30519600,48.46261100],&quot;coordinates&quot;:[-123.30519600,48.46261100]}&#39;</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="keywordflow">elif</span> spatialite:</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            victoria_json = <span class="stringliteral">&#39;{&quot;type&quot;:&quot;Point&quot;,&quot;bbox&quot;:[-123.305196,48.462611,-123.305196,48.462611],&quot;coordinates&quot;:[-123.305196,48.462611]}&#39;</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="comment"># Precision argument should only be an integer</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        self.assertRaises(TypeError, City.objects.geojson, precision=<span class="stringliteral">&#39;foo&#39;</span>)</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <span class="comment"># Reference queries and values.</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <span class="comment"># SELECT ST_AsGeoJson(&quot;geoapp_city&quot;.&quot;point&quot;, 8, 0) FROM &quot;geoapp_city&quot; WHERE &quot;geoapp_city&quot;.&quot;name&quot; = &#39;Pueblo&#39;;</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        self.assertEqual(pueblo_json, City.objects.geojson().get(name=<span class="stringliteral">&#39;Pueblo&#39;</span>).geojson)</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <span class="comment"># 1.3.x: SELECT ST_AsGeoJson(&quot;geoapp_city&quot;.&quot;point&quot;, 8, 1) FROM &quot;geoapp_city&quot; WHERE &quot;geoapp_city&quot;.&quot;name&quot; = &#39;Houston&#39;;</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="comment"># 1.4.x: SELECT ST_AsGeoJson(&quot;geoapp_city&quot;.&quot;point&quot;, 8, 2) FROM &quot;geoapp_city&quot; WHERE &quot;geoapp_city&quot;.&quot;name&quot; = &#39;Houston&#39;;</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="comment"># This time we want to include the CRS by using the `crs` keyword.</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        self.assertEqual(houston_json, City.objects.geojson(crs=<span class="keyword">True</span>, model_att=<span class="stringliteral">&#39;json&#39;</span>).get(name=<span class="stringliteral">&#39;Houston&#39;</span>).json)</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="comment"># 1.3.x: SELECT ST_AsGeoJson(&quot;geoapp_city&quot;.&quot;point&quot;, 8, 2) FROM &quot;geoapp_city&quot; WHERE &quot;geoapp_city&quot;.&quot;name&quot; = &#39;Victoria&#39;;</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="comment"># 1.4.x: SELECT ST_AsGeoJson(&quot;geoapp_city&quot;.&quot;point&quot;, 8, 1) FROM &quot;geoapp_city&quot; WHERE &quot;geoapp_city&quot;.&quot;name&quot; = &#39;Houston&#39;;</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <span class="comment"># This time we include the bounding box by using the `bbox` keyword.</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        self.assertEqual(victoria_json, City.objects.geojson(bbox=<span class="keyword">True</span>).get(name=<span class="stringliteral">&#39;Victoria&#39;</span>).geojson)</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <span class="comment"># 1.(3|4).x: SELECT ST_AsGeoJson(&quot;geoapp_city&quot;.&quot;point&quot;, 5, 3) FROM &quot;geoapp_city&quot; WHERE &quot;geoapp_city&quot;.&quot;name&quot; = &#39;Chicago&#39;;</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="comment"># Finally, we set every available keyword.</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        self.assertEqual(chicago_json, City.objects.geojson(bbox=<span class="keyword">True</span>, crs=<span class="keyword">True</span>, precision=5).get(name=<span class="stringliteral">&#39;Chicago&#39;</span>).geojson)</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div>
<div class="line"><a name="l00521"></a><span class="lineno"><a class="line" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#aa8ff1ee95bfc6e4aa58a7455ba8b4395">  521</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#aa8ff1ee95bfc6e4aa58a7455ba8b4395">test_gml</a>(self):</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <span class="stringliteral">&quot;Testing GML output from the database using GeoQuerySet.gml().&quot;</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <span class="keywordflow">if</span> mysql <span class="keywordflow">or</span> (spatialite <span class="keywordflow">and</span> <span class="keywordflow">not</span> connection.ops.gml) :</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            self.assertRaises(NotImplementedError, Country.objects.all().gml, field_name=<span class="stringliteral">&#39;mpoly&#39;</span>)</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            <span class="keywordflow">return</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        <span class="comment"># Should throw a TypeError when tyring to obtain GML from a</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <span class="comment"># non-geometry field.</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        qs = City.objects.all()</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        self.assertRaises(TypeError, qs.gml, field_name=<span class="stringliteral">&#39;name&#39;</span>)</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        ptown1 = City.objects.gml(field_name=<span class="stringliteral">&#39;point&#39;</span>, precision=9).get(name=<span class="stringliteral">&#39;Pueblo&#39;</span>)</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        ptown2 = City.objects.gml(precision=9).get(name=<span class="stringliteral">&#39;Pueblo&#39;</span>)</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <span class="keywordflow">if</span> oracle:</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            <span class="comment"># No precision parameter for Oracle :-/</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            gml_regex = re.compile(<span class="stringliteral">r&#39;^&lt;gml:Point srsName=&quot;SDO:4326&quot; xmlns:gml=&quot;http://www.opengis.net/gml&quot;&gt;&lt;gml:coordinates decimal=&quot;\.&quot; cs=&quot;,&quot; ts=&quot; &quot;&gt;-104.60925\d+,38.25500\d+ &lt;/gml:coordinates&gt;&lt;/gml:Point&gt;&#39;</span>)</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        <span class="keywordflow">elif</span> spatialite <span class="keywordflow">and</span> connection.ops.spatial_version &lt; (3, 0, 0):</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            <span class="comment"># Spatialite before 3.0 has extra colon in SrsName</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            gml_regex = re.compile(<span class="stringliteral">r&#39;^&lt;gml:Point SrsName=&quot;EPSG::4326&quot;&gt;&lt;gml:coordinates decimal=&quot;\.&quot; cs=&quot;,&quot; ts=&quot; &quot;&gt;-104.609251\d+,38.255001&lt;/gml:coordinates&gt;&lt;/gml:Point&gt;&#39;</span>)</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            gml_regex = re.compile(<span class="stringliteral">r&#39;^&lt;gml:Point srsName=&quot;EPSG:4326&quot;&gt;&lt;gml:coordinates&gt;-104\.60925\d+,38\.255001&lt;/gml:coordinates&gt;&lt;/gml:Point&gt;&#39;</span>)</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <span class="keywordflow">for</span> ptown <span class="keywordflow">in</span> [ptown1, ptown2]:</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            self.assertTrue(gml_regex.match(ptown.gml))</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        <span class="comment"># PostGIS &lt; 1.5 doesn&#39;t include dimension im GMLv3 output.</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        <span class="keywordflow">if</span> postgis <span class="keywordflow">and</span> connection.ops.spatial_version &gt;= (1, 5, 0):</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            self.assertIn(<span class="stringliteral">&#39;&lt;gml:pos srsDimension=&quot;2&quot;&gt;&#39;</span>,</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                          City.objects.gml(version=3).get(name=<span class="stringliteral">&#39;Pueblo&#39;</span>).gml)</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div>
<div class="line"><a name="l00551"></a><span class="lineno"><a class="line" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#ae79e8612454b9cb0b25730c3b0bd4e4d">  551</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#ae79e8612454b9cb0b25730c3b0bd4e4d">test_kml</a>(self):</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <span class="stringliteral">&quot;Testing KML output from the database using GeoQuerySet.kml().&quot;</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <span class="comment"># Only PostGIS and Spatialite (&gt;=2.4.0-RC4) support KML serialization</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> (postgis <span class="keywordflow">or</span> (spatialite <span class="keywordflow">and</span> connection.ops.kml)):</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            self.assertRaises(NotImplementedError, State.objects.all().kml, field_name=<span class="stringliteral">&#39;poly&#39;</span>)</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            <span class="keywordflow">return</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        <span class="comment"># Should throw a TypeError when trying to obtain KML from a</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="comment">#  non-geometry field.</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        qs = City.objects.all()</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        self.assertRaises(TypeError, qs.kml, <span class="stringliteral">&#39;name&#39;</span>)</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        <span class="comment"># The reference KML depends on the version of PostGIS used</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <span class="comment"># (the output stopped including altitude in 1.3.3).</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <span class="keywordflow">if</span> connection.ops.spatial_version &gt;= (1, 3, 3):</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            ref_kml =  <span class="stringliteral">&#39;&lt;Point&gt;&lt;coordinates&gt;-104.609252,38.255001&lt;/coordinates&gt;&lt;/Point&gt;&#39;</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;            ref_kml = <span class="stringliteral">&#39;&lt;Point&gt;&lt;coordinates&gt;-104.609252,38.255001,0&lt;/coordinates&gt;&lt;/Point&gt;&#39;</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <span class="comment"># Ensuring the KML is as expected.</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        ptown1 = City.objects.kml(field_name=<span class="stringliteral">&#39;point&#39;</span>, precision=9).get(name=<span class="stringliteral">&#39;Pueblo&#39;</span>)</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        ptown2 = City.objects.kml(precision=9).get(name=<span class="stringliteral">&#39;Pueblo&#39;</span>)</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        <span class="keywordflow">for</span> ptown <span class="keywordflow">in</span> [ptown1, ptown2]:</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            self.assertEqual(ref_kml, ptown.kml)</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="comment"># Only PostGIS has support for the MakeLine aggregate.</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    @no_mysql</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    @no_oracle</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    @no_spatialite</div>
<div class="line"><a name="l00580"></a><span class="lineno"><a class="line" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#a6c06e978159b0663fd0c8012c84eb41b">  580</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#a6c06e978159b0663fd0c8012c84eb41b">test_make_line</a>(self):</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        <span class="stringliteral">&quot;Testing the `make_line` GeoQuerySet method.&quot;</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="comment"># Ensuring that a `TypeError` is raised on models without PointFields.</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        self.assertRaises(TypeError, State.objects.make_line)</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        self.assertRaises(TypeError, Country.objects.make_line)</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <span class="comment"># Reference query:</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <span class="comment"># SELECT AsText(ST_MakeLine(geoapp_city.point)) FROM geoapp_city;</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        ref_line = GEOSGeometry(<span class="stringliteral">&#39;LINESTRING(-95.363151 29.763374,-96.801611 32.782057,-97.521157 34.464642,174.783117 -41.315268,-104.609252 38.255001,-95.23506 38.971823,-87.650175 41.850385,-123.305196 48.462611)&#39;</span>, srid=4326)</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        self.assertEqual(ref_line, City.objects.make_line())</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    @no_mysql</div>
<div class="line"><a name="l00591"></a><span class="lineno"><a class="line" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#abab09ef4dd7123d2087a631ce74d382f">  591</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#abab09ef4dd7123d2087a631ce74d382f">test_num_geom</a>(self):</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <span class="stringliteral">&quot;Testing the `num_geom` GeoQuerySet method.&quot;</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        <span class="comment"># Both &#39;countries&#39; only have two geometries.</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="keywordflow">for</span> c <span class="keywordflow">in</span> Country.objects.num_geom():</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            self.assertEqual(2, c.num_geom)</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <span class="keywordflow">for</span> c <span class="keywordflow">in</span> City.objects.filter(point__isnull=<span class="keyword">False</span>).num_geom():</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;            <span class="comment"># Oracle and PostGIS 2.0+ will return 1 for the number of</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;            <span class="comment"># geometries on non-collections, whereas PostGIS &lt; 2.0.0</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            <span class="comment"># will return None.</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            <span class="keywordflow">if</span> postgis <span class="keywordflow">and</span> connection.ops.spatial_version &lt; (2, 0, 0):</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                self.assertIsNone(c.num_geom)</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                self.assertEqual(1, c.num_geom)</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    @no_mysql</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    @no_spatialite <span class="comment"># SpatiaLite can only count vertices in LineStrings</span></div>
<div class="line"><a name="l00608"></a><span class="lineno"><a class="line" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#aa32e5c11bc8aab809ebcf651f6d27267">  608</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#aa32e5c11bc8aab809ebcf651f6d27267">test_num_points</a>(self):</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <span class="stringliteral">&quot;Testing the `num_points` GeoQuerySet method.&quot;</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="keywordflow">for</span> c <span class="keywordflow">in</span> Country.objects.num_points():</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            self.assertEqual(c.mpoly.num_points, c.num_points)</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> oracle:</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            <span class="comment"># Oracle cannot count vertices in Point geometries.</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;            <span class="keywordflow">for</span> c <span class="keywordflow">in</span> City.objects.num_points(): self.assertEqual(1, c.num_points)</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    @no_mysql</div>
<div class="line"><a name="l00618"></a><span class="lineno"><a class="line" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#af183d8865cc316fdc882705159bfdedd">  618</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#af183d8865cc316fdc882705159bfdedd">test_point_on_surface</a>(self):</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <span class="stringliteral">&quot;Testing the `point_on_surface` GeoQuerySet method.&quot;</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <span class="comment"># Reference values.</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="keywordflow">if</span> oracle:</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            <span class="comment"># SELECT SDO_UTIL.TO_WKTGEOMETRY(SDO_GEOM.SDO_POINTONSURFACE(GEOAPP_COUNTRY.MPOLY, 0.05)) FROM GEOAPP_COUNTRY;</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            ref = {<span class="stringliteral">&#39;New Zealand&#39;</span> : <a class="code" href="../../df/d10/namespacedjango_1_1contrib_1_1gis_1_1geos_1_1factory.html#a07ad8dd2ccf181fd3dd033955cfc2c4c">fromstr</a>(<span class="stringliteral">&#39;POINT (174.616364 -36.100861)&#39;</span>, srid=4326),</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                   <span class="stringliteral">&#39;Texas&#39;</span> : <a class="code" href="../../df/d10/namespacedjango_1_1contrib_1_1gis_1_1geos_1_1factory.html#a07ad8dd2ccf181fd3dd033955cfc2c4c">fromstr</a>(<span class="stringliteral">&#39;POINT (-103.002434 36.500397)&#39;</span>, srid=4326),</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                   }</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        <span class="keywordflow">elif</span> postgis <span class="keywordflow">or</span> spatialite:</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            <span class="comment"># Using GEOSGeometry to compute the reference point on surface values</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            <span class="comment"># -- since PostGIS also uses GEOS these should be the same.</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            ref = {<span class="stringliteral">&#39;New Zealand&#39;</span> : Country.objects.get(name=<span class="stringliteral">&#39;New Zealand&#39;</span>).mpoly.point_on_surface,</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                   <span class="stringliteral">&#39;Texas&#39;</span> : Country.objects.get(name=<span class="stringliteral">&#39;Texas&#39;</span>).mpoly.point_on_surface</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                   }</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="keywordflow">for</span> c <span class="keywordflow">in</span> Country.objects.point_on_surface():</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            <span class="keywordflow">if</span> spatialite:</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                <span class="comment"># XXX This seems to be a WKT-translation-related precision issue?</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                tol = 0.00001</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                tol = 0.000000001</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;            self.assertEqual(<span class="keyword">True</span>, ref[c.name].equals_exact(c.point_on_surface, tol))</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    @no_mysql</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    @no_spatialite</div>
<div class="line"><a name="l00644"></a><span class="lineno"><a class="line" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#ae81a53ecfa55ca39401b3354f2390645">  644</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#ae81a53ecfa55ca39401b3354f2390645">test_reverse_geom</a>(self):</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <span class="stringliteral">&quot;Testing GeoQuerySet.reverse_geom().&quot;</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        coords = [ (-95.363151, 29.763374), (-95.448601, 29.713803) ]</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        Track.objects.create(name=<span class="stringliteral">&#39;Foo&#39;</span>, line=LineString(coords))</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        t = Track.objects.reverse_geom().get(name=<span class="stringliteral">&#39;Foo&#39;</span>)</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        coords.reverse()</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        self.assertEqual(tuple(coords), t.reverse_geom.coords)</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        <span class="keywordflow">if</span> oracle:</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;            self.assertRaises(TypeError, State.objects.reverse_geom)</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    @no_mysql</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    @no_oracle</div>
<div class="line"><a name="l00656"></a><span class="lineno"><a class="line" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#aa8b5728eeb5e03f51f5ec6fa4161d9ad">  656</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#aa8b5728eeb5e03f51f5ec6fa4161d9ad">test_scale</a>(self):</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <span class="stringliteral">&quot;Testing the `scale` GeoQuerySet method.&quot;</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        xfac, yfac = 2, 3</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        tol = 5 <span class="comment"># XXX The low precision tolerance is for SpatiaLite</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        qs = Country.objects.scale(xfac, yfac, model_att=<span class="stringliteral">&#39;scaled&#39;</span>)</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        <span class="keywordflow">for</span> c <span class="keywordflow">in</span> qs:</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;            <span class="keywordflow">for</span> p1, p2 <span class="keywordflow">in</span> zip(c.mpoly, c.scaled):</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                <span class="keywordflow">for</span> r1, r2 <span class="keywordflow">in</span> zip(p1, p2):</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                    <span class="keywordflow">for</span> c1, c2 <span class="keywordflow">in</span> zip(r1.coords, r2.coords):</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                        self.assertAlmostEqual(c1[0] * xfac, c2[0], tol)</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                        self.assertAlmostEqual(c1[1] * yfac, c2[1], tol)</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    @no_mysql</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    @no_oracle</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    @no_spatialite</div>
<div class="line"><a name="l00671"></a><span class="lineno"><a class="line" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#a1e335e98afec77917bc0772ddf3366a4">  671</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#a1e335e98afec77917bc0772ddf3366a4">test_snap_to_grid</a>(self):</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        <span class="stringliteral">&quot;Testing GeoQuerySet.snap_to_grid().&quot;</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <span class="comment"># Let&#39;s try and break snap_to_grid() with bad combinations of arguments.</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        <span class="keywordflow">for</span> bad_args <span class="keywordflow">in</span> ((), range(3), range(5)):</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;            self.assertRaises(ValueError, Country.objects.snap_to_grid, *bad_args)</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        <span class="keywordflow">for</span> bad_args <span class="keywordflow">in</span> ((<span class="stringliteral">&#39;1.0&#39;</span>,), (1.0, <span class="keywordtype">None</span>), tuple(map(six.text_type, range(4)))):</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;            self.assertRaises(TypeError, Country.objects.snap_to_grid, *bad_args)</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <span class="comment"># Boundary for San Marino, courtesy of Bjorn Sandvik of thematicmapping.org</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        <span class="comment"># from the world borders dataset he provides.</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        wkt = (<span class="stringliteral">&#39;MULTIPOLYGON(((12.41580 43.95795,12.45055 43.97972,12.45389 43.98167,&#39;</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;               <span class="stringliteral">&#39;12.46250 43.98472,12.47167 43.98694,12.49278 43.98917,&#39;</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;               <span class="stringliteral">&#39;12.50555 43.98861,12.51000 43.98694,12.51028 43.98277,&#39;</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;               <span class="stringliteral">&#39;12.51167 43.94333,12.51056 43.93916,12.49639 43.92333,&#39;</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;               <span class="stringliteral">&#39;12.49500 43.91472,12.48778 43.90583,12.47444 43.89722,&#39;</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;               <span class="stringliteral">&#39;12.46472 43.89555,12.45917 43.89611,12.41639 43.90472,&#39;</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;               <span class="stringliteral">&#39;12.41222 43.90610,12.40782 43.91366,12.40389 43.92667,&#39;</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;               <span class="stringliteral">&#39;12.40500 43.94833,12.40889 43.95499,12.41580 43.95795)))&#39;</span>)</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        sm = Country.objects.create(name=<span class="stringliteral">&#39;San Marino&#39;</span>, mpoly=<a class="code" href="../../df/d10/namespacedjango_1_1contrib_1_1gis_1_1geos_1_1factory.html#a07ad8dd2ccf181fd3dd033955cfc2c4c">fromstr</a>(wkt))</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        <span class="comment"># Because floating-point arithmetic isn&#39;t exact, we set a tolerance</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        <span class="comment"># to pass into GEOS `equals_exact`.</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        tol = 0.000000001</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        <span class="comment"># SELECT AsText(ST_SnapToGrid(&quot;geoapp_country&quot;.&quot;mpoly&quot;, 0.1)) FROM &quot;geoapp_country&quot; WHERE &quot;geoapp_country&quot;.&quot;name&quot; = &#39;San Marino&#39;;</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        ref = <a class="code" href="../../df/d10/namespacedjango_1_1contrib_1_1gis_1_1geos_1_1factory.html#a07ad8dd2ccf181fd3dd033955cfc2c4c">fromstr</a>(<span class="stringliteral">&#39;MULTIPOLYGON(((12.4 44,12.5 44,12.5 43.9,12.4 43.9,12.4 44)))&#39;</span>)</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        self.assertTrue(ref.equals_exact(Country.objects.snap_to_grid(0.1).get(name=<span class="stringliteral">&#39;San Marino&#39;</span>).snap_to_grid, tol))</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <span class="comment"># SELECT AsText(ST_SnapToGrid(&quot;geoapp_country&quot;.&quot;mpoly&quot;, 0.05, 0.23)) FROM &quot;geoapp_country&quot; WHERE &quot;geoapp_country&quot;.&quot;name&quot; = &#39;San Marino&#39;;</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        ref = <a class="code" href="../../df/d10/namespacedjango_1_1contrib_1_1gis_1_1geos_1_1factory.html#a07ad8dd2ccf181fd3dd033955cfc2c4c">fromstr</a>(<span class="stringliteral">&#39;MULTIPOLYGON(((12.4 43.93,12.45 43.93,12.5 43.93,12.45 43.93,12.4 43.93)))&#39;</span>)</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        self.assertTrue(ref.equals_exact(Country.objects.snap_to_grid(0.05, 0.23).get(name=<span class="stringliteral">&#39;San Marino&#39;</span>).snap_to_grid, tol))</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        <span class="comment"># SELECT AsText(ST_SnapToGrid(&quot;geoapp_country&quot;.&quot;mpoly&quot;, 0.5, 0.17, 0.05, 0.23)) FROM &quot;geoapp_country&quot; WHERE &quot;geoapp_country&quot;.&quot;name&quot; = &#39;San Marino&#39;;</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        ref = <a class="code" href="../../df/d10/namespacedjango_1_1contrib_1_1gis_1_1geos_1_1factory.html#a07ad8dd2ccf181fd3dd033955cfc2c4c">fromstr</a>(<span class="stringliteral">&#39;MULTIPOLYGON(((12.4 43.87,12.45 43.87,12.45 44.1,12.5 44.1,12.5 43.87,12.45 43.87,12.4 43.87)))&#39;</span>)</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        self.assertTrue(ref.equals_exact(Country.objects.snap_to_grid(0.05, 0.23, 0.5, 0.17).get(name=<span class="stringliteral">&#39;San Marino&#39;</span>).snap_to_grid, tol))</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div>
<div class="line"><a name="l00707"></a><span class="lineno"><a class="line" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#af17bc3acacbe5482df6c4110f830ff92">  707</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#af17bc3acacbe5482df6c4110f830ff92">test_svg</a>(self):</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        <span class="stringliteral">&quot;Testing SVG output using GeoQuerySet.svg().&quot;</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        <span class="keywordflow">if</span> mysql <span class="keywordflow">or</span> oracle:</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;            self.assertRaises(NotImplementedError, City.objects.svg)</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;            <span class="keywordflow">return</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        self.assertRaises(TypeError, City.objects.svg, precision=<span class="stringliteral">&#39;foo&#39;</span>)</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        <span class="comment"># SELECT AsSVG(geoapp_city.point, 0, 8) FROM geoapp_city WHERE name = &#39;Pueblo&#39;;</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        svg1 = <span class="stringliteral">&#39;cx=&quot;-104.609252&quot; cy=&quot;-38.255001&quot;&#39;</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        <span class="comment"># Even though relative, only one point so it&#39;s practically the same except for</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        <span class="comment"># the &#39;c&#39; letter prefix on the x,y values.</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        svg2 = svg1.replace(<span class="stringliteral">&#39;c&#39;</span>, <span class="stringliteral">&#39;&#39;</span>)</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        self.assertEqual(svg1, City.objects.svg().get(name=<span class="stringliteral">&#39;Pueblo&#39;</span>).svg)</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        self.assertEqual(svg2, City.objects.svg(relative=5).get(name=<span class="stringliteral">&#39;Pueblo&#39;</span>).svg)</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    @no_mysql</div>
<div class="line"><a name="l00723"></a><span class="lineno"><a class="line" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#a5bcbc0af07dc22854e953d429ca18847">  723</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#a5bcbc0af07dc22854e953d429ca18847">test_transform</a>(self):</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        <span class="stringliteral">&quot;Testing the transform() GeoQuerySet method.&quot;</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        <span class="comment"># Pre-transformed points for Houston and Pueblo.</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        htown = <a class="code" href="../../df/d10/namespacedjango_1_1contrib_1_1gis_1_1geos_1_1factory.html#a07ad8dd2ccf181fd3dd033955cfc2c4c">fromstr</a>(<span class="stringliteral">&#39;POINT(1947516.83115183 6322297.06040572)&#39;</span>, srid=3084)</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        ptown = <a class="code" href="../../df/d10/namespacedjango_1_1contrib_1_1gis_1_1geos_1_1factory.html#a07ad8dd2ccf181fd3dd033955cfc2c4c">fromstr</a>(<span class="stringliteral">&#39;POINT(992363.390841912 481455.395105533)&#39;</span>, srid=2774)</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        prec = 3 <span class="comment"># Precision is low due to version variations in PROJ and GDAL.</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        <span class="comment"># Asserting the result of the transform operation with the values in</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        <span class="comment">#  the pre-transformed points.  Oracle does not have the 3084 SRID.</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> oracle:</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            h = City.objects.transform(htown.srid).get(name=<span class="stringliteral">&#39;Houston&#39;</span>)</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            self.assertEqual(3084, h.point.srid)</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;            self.assertAlmostEqual(htown.x, h.point.x, prec)</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;            self.assertAlmostEqual(htown.y, h.point.y, prec)</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        p1 = City.objects.transform(ptown.srid, field_name=<span class="stringliteral">&#39;point&#39;</span>).get(name=<span class="stringliteral">&#39;Pueblo&#39;</span>)</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        p2 = City.objects.transform(srid=ptown.srid).get(name=<span class="stringliteral">&#39;Pueblo&#39;</span>)</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        <span class="keywordflow">for</span> p <span class="keywordflow">in</span> [p1, p2]:</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;            self.assertEqual(2774, p.point.srid)</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;            self.assertAlmostEqual(ptown.x, p.point.x, prec)</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            self.assertAlmostEqual(ptown.y, p.point.y, prec)</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    @no_mysql</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    @no_oracle</div>
<div class="line"><a name="l00747"></a><span class="lineno"><a class="line" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#a75decd5e6b029f81f9ce68b2caff1297">  747</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#a75decd5e6b029f81f9ce68b2caff1297">test_translate</a>(self):</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        <span class="stringliteral">&quot;Testing the `translate` GeoQuerySet method.&quot;</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        xfac, yfac = 5, -23</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        qs = Country.objects.translate(xfac, yfac, model_att=<span class="stringliteral">&#39;translated&#39;</span>)</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        <span class="keywordflow">for</span> c <span class="keywordflow">in</span> qs:</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            <span class="keywordflow">for</span> p1, p2 <span class="keywordflow">in</span> zip(c.mpoly, c.translated):</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                <span class="keywordflow">for</span> r1, r2 <span class="keywordflow">in</span> zip(p1, p2):</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                    <span class="keywordflow">for</span> c1, c2 <span class="keywordflow">in</span> zip(r1.coords, r2.coords):</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                        <span class="comment"># XXX The low precision is for SpatiaLite</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                        self.assertAlmostEqual(c1[0] + xfac, c2[0], 5)</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                        self.assertAlmostEqual(c1[1] + yfac, c2[1], 5)</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="comment"># TODO: Oracle can be made to pass if</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="comment"># union1 = union2 = fromstr(&#39;POINT (-97.5211570000000023 34.4646419999999978)&#39;)</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="comment"># but this seems unexpected and should be investigated to determine the cause.</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    @no_mysql</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    @no_oracle</div>
<div class="line"><a name="l00764"></a><span class="lineno"><a class="line" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#ab752c797a9ba443e8cd311105465345d">  764</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#ab752c797a9ba443e8cd311105465345d">test_unionagg</a>(self):</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        <span class="stringliteral">&quot;Testing the `unionagg` (aggregate union) GeoQuerySet method.&quot;</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        tx = Country.objects.get(name=<span class="stringliteral">&#39;Texas&#39;</span>).mpoly</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        <span class="comment"># Houston, Dallas -- Oracle has different order.</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        union1 = <a class="code" href="../../df/d10/namespacedjango_1_1contrib_1_1gis_1_1geos_1_1factory.html#a07ad8dd2ccf181fd3dd033955cfc2c4c">fromstr</a>(<span class="stringliteral">&#39;MULTIPOINT(-96.801611 32.782057,-95.363151 29.763374)&#39;</span>)</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        union2 = <a class="code" href="../../df/d10/namespacedjango_1_1contrib_1_1gis_1_1geos_1_1factory.html#a07ad8dd2ccf181fd3dd033955cfc2c4c">fromstr</a>(<span class="stringliteral">&#39;MULTIPOINT(-96.801611 32.782057,-95.363151 29.763374)&#39;</span>)</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        qs = City.objects.filter(point__within=tx)</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        self.assertRaises(TypeError, qs.unionagg, <span class="stringliteral">&#39;name&#39;</span>)</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        <span class="comment"># Using `field_name` keyword argument in one query and specifying an</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        <span class="comment"># order in the other (which should not be used because this is</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        <span class="comment"># an aggregate method on a spatial column)</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        u1 = qs.unionagg(field_name=<span class="stringliteral">&#39;point&#39;</span>)</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        u2 = qs.order_by(<span class="stringliteral">&#39;name&#39;</span>).unionagg()</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        tol = 0.00001</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        <span class="keywordflow">if</span> oracle:</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            union = union2</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            union = union1</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        self.assertEqual(<span class="keyword">True</span>, union.equals_exact(u1, tol))</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        self.assertEqual(<span class="keyword">True</span>, union.equals_exact(u2, tol))</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        qs = City.objects.filter(name=<span class="stringliteral">&#39;NotACity&#39;</span>)</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        self.assertEqual(<span class="keywordtype">None</span>, qs.unionagg(field_name=<span class="stringliteral">&#39;point&#39;</span>))</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div>
<div class="line"><a name="l00787"></a><span class="lineno"><a class="line" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#ac9c836a8eaaa5feae09f5ebc6fa0f88f">  787</a></span>&#160;    <span class="keyword">def </span><a class="code" href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#ac9c836a8eaaa5feae09f5ebc6fa0f88f">test_non_concrete_field</a>(self):</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        pkfield = City._meta.get_field_by_name(<span class="stringliteral">&#39;id&#39;</span>)[0]</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        orig_pkfield_col = pkfield.column</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        pkfield.column = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;            list(City.objects.all())</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <span class="keywordflow">finally</span>:</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            pkfield.column = orig_pkfield_col</div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test_html_ab752c797a9ba443e8cd311105465345d"><div class="ttname"><a href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#ab752c797a9ba443e8cd311105465345d">django.contrib.gis.tests.geoapp.tests.GeoQuerySetTest.test_unionagg</a></div><div class="ttdeci">def test_unionagg(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00764">tests.py:764</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test_html_a98ffb8f3bc734a4b8120415786705350"><div class="ttname"><a href="../../d9/d8c/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test.html#a98ffb8f3bc734a4b8120415786705350">django.contrib.gis.tests.geoapp.tests.GeoLookupTest.test_relate_lookup</a></div><div class="ttdeci">def test_relate_lookup(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00350">tests.py:350</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test_html_aeb75fa45b03442ce2ae9caa0a24595cf"><div class="ttname"><a href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#aeb75fa45b03442ce2ae9caa0a24595cf">django.contrib.gis.tests.geoapp.tests.GeoQuerySetTest.test_force_rhr</a></div><div class="ttdeci">def test_force_rhr(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00455">tests.py:455</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test_html"><div class="ttname"><a href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html">django.contrib.gis.tests.geoapp.tests.GeoQuerySetTest</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00394">tests.py:394</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test_html_aa32e5c11bc8aab809ebcf651f6d27267"><div class="ttname"><a href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#aa32e5c11bc8aab809ebcf651f6d27267">django.contrib.gis.tests.geoapp.tests.GeoQuerySetTest.test_num_points</a></div><div class="ttdeci">def test_num_points(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00608">tests.py:608</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test_html"><div class="ttname"><a href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html">django.contrib.gis.tests.geoapp.tests.GeoModelTest</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00031">tests.py:31</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test_html_a47e931cd43ee4f96a1f0f947515b1c06"><div class="ttname"><a href="../../d9/d8c/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test.html#a47e931cd43ee4f96a1f0f947515b1c06">django.contrib.gis.tests.geoapp.tests.GeoLookupTest.test_equals_lookups</a></div><div class="ttdeci">def test_equals_lookups(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00311">tests.py:311</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test_html_aa83d16938dcdcd8acc988ab6c49c69a4"><div class="ttname"><a href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html#aa83d16938dcdcd8acc988ab6c49c69a4">django.contrib.gis.tests.geoapp.tests.GeoModelTest.test_proxy</a></div><div class="ttdeci">def test_proxy(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00040">tests.py:40</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test_html_abab09ef4dd7123d2087a631ce74d382f"><div class="ttname"><a href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#abab09ef4dd7123d2087a631ce74d382f">django.contrib.gis.tests.geoapp.tests.GeoQuerySetTest.test_num_geom</a></div><div class="ttdeci">def test_num_geom(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00591">tests.py:591</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test_html_abd3e3784904ec33e48e6ffdbc7a0e325"><div class="ttname"><a href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html#abd3e3784904ec33e48e6ffdbc7a0e325">django.contrib.gis.tests.geoapp.tests.GeoModelTest.test_inherited_geofields</a></div><div class="ttdeci">def test_inherited_geofields(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00182">tests.py:182</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test_html_ae79e8612454b9cb0b25730c3b0bd4e4d"><div class="ttname"><a href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#ae79e8612454b9cb0b25730c3b0bd4e4d">django.contrib.gis.tests.geoapp.tests.GeoQuerySetTest.test_kml</a></div><div class="ttdeci">def test_kml(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00551">tests.py:551</a></div></div>
<div class="ttc" id="namespacedjango_1_1utils_html"><div class="ttname"><a href="../../da/d57/namespacedjango_1_1utils.html">django.utils</a></div><div class="ttdoc">::2to3_fixes::fix_unicode </div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test_html_ac9c836a8eaaa5feae09f5ebc6fa0f88f"><div class="ttname"><a href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#ac9c836a8eaaa5feae09f5ebc6fa0f88f">django.contrib.gis.tests.geoapp.tests.GeoQuerySetTest.test_non_concrete_field</a></div><div class="ttdeci">def test_non_concrete_field(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00787">tests.py:787</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test_html_a94eba618cf6c64a591472f53b0b1d540"><div class="ttname"><a href="../../d9/d8c/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test.html#a94eba618cf6c64a591472f53b0b1d540">django.contrib.gis.tests.geoapp.tests.GeoLookupTest.test_left_right_lookups</a></div><div class="ttdeci">tuple test_left_right_lookups</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00309">tests.py:309</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test_html_a08b5edb217551dc50f72dce77c4531b1"><div class="ttname"><a href="../../d9/d8c/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test.html#a08b5edb217551dc50f72dce77c4531b1">django.contrib.gis.tests.geoapp.tests.GeoLookupTest.test_contains_contained_lookups</a></div><div class="ttdeci">def test_contains_contained_lookups(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00221">tests.py:221</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test_html_af183d8865cc316fdc882705159bfdedd"><div class="ttname"><a href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#af183d8865cc316fdc882705159bfdedd">django.contrib.gis.tests.geoapp.tests.GeoQuerySetTest.test_point_on_surface</a></div><div class="ttdeci">def test_point_on_surface(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00618">tests.py:618</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test_html_a3976553a39d24acd960d3554aff8dd36"><div class="ttname"><a href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#a3976553a39d24acd960d3554aff8dd36">django.contrib.gis.tests.geoapp.tests.GeoQuerySetTest.test_centroid</a></div><div class="ttdeci">def test_centroid(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00398">tests.py:398</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test_html_aeea453266cbe994306c97983c62c3b11"><div class="ttname"><a href="../../d9/d8c/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test.html#aeea453266cbe994306c97983c62c3b11">django.contrib.gis.tests.geoapp.tests.GeoLookupTest.test_null_geometries</a></div><div class="ttdeci">def test_null_geometries(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00320">tests.py:320</a></div></div>
<div class="ttc" id="namespacedjango_1_1utils_1_1unittest_html"><div class="ttname"><a href="../../d7/ddc/namespacedjango_1_1utils_1_1unittest.html">django.utils.unittest</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d79/utils_2unittest_2____init_____8py_source.html#l00001">__init__.py:1</a></div></div>
<div class="ttc" id="namespacedjango_1_1contrib_1_1gis_html"><div class="ttname"><a href="../../d3/d12/namespacedjango_1_1contrib_1_1gis.html">django.contrib.gis</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d7d/contrib_2gis_2____init_____8py_source.html#l00001">__init__.py:1</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test_html_aa8ff1ee95bfc6e4aa58a7455ba8b4395"><div class="ttname"><a href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#aa8ff1ee95bfc6e4aa58a7455ba8b4395">django.contrib.gis.tests.geoapp.tests.GeoQuerySetTest.test_gml</a></div><div class="ttdeci">def test_gml(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00521">tests.py:521</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test_html_a1d401d2c4d0e51b0a9bee2968246dc35"><div class="ttname"><a href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#a1d401d2c4d0e51b0a9bee2968246dc35">django.contrib.gis.tests.geoapp.tests.GeoQuerySetTest.test_diff_intersection_union</a></div><div class="ttdeci">def test_diff_intersection_union(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00411">tests.py:411</a></div></div>
<div class="ttc" id="namespacedjango_1_1utils_1_1unittest_1_1case_html_ac3f15fbae74f2de4b84110a900d8450b"><div class="ttname"><a href="../../d6/dd5/namespacedjango_1_1utils_1_1unittest_1_1case.html#ac3f15fbae74f2de4b84110a900d8450b">django.utils.unittest.case.skipUnless</a></div><div class="ttdeci">def skipUnless(condition, reason)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d63/case_8py_source.html#l00075">case.py:75</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1gdal_1_1srs_1_1_spatial_reference_html"><div class="ttname"><a href="../../d7/dda/classdjango_1_1contrib_1_1gis_1_1gdal_1_1srs_1_1_spatial_reference.html">django.contrib.gis.gdal.srs.SpatialReference</a></div><div class="ttdoc">Spatial Reference class. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d89/gdal_2srs_8py_source.html#l00041">srs.py:41</a></div></div>
<div class="ttc" id="namespacedjango_1_1test_html"><div class="ttname"><a href="../../d6/d4c/namespacedjango_1_1test.html">django.test</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d9d/test_2____init_____8py_source.html#l00001">__init__.py:1</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test_html"><div class="ttname"><a href="../../d9/d8c/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test.html">django.contrib.gis.tests.geoapp.tests.GeoLookupTest</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00208">tests.py:208</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test_html_a56675db1c4056e56e173ca8340e88c6b"><div class="ttname"><a href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html#a56675db1c4056e56e173ca8340e88c6b">django.contrib.gis.tests.geoapp.tests.GeoModelTest.test_raw_sql_query</a></div><div class="ttdeci">def test_raw_sql_query(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00194">tests.py:194</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test_html_af6e2eaa4ee34cd022ee1ea9116875f0c"><div class="ttname"><a href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html#af6e2eaa4ee34cd022ee1ea9116875f0c">django.contrib.gis.tests.geoapp.tests.GeoModelTest.test_lookup_insert_transform</a></div><div class="ttdeci">def test_lookup_insert_transform(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00109">tests.py:109</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test_html_a91172ffcb726ea2d9f34a303d8ff3f8c"><div class="ttname"><a href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html#a91172ffcb726ea2d9f34a303d8ff3f8c">django.contrib.gis.tests.geoapp.tests.GeoModelTest.test_fixtures</a></div><div class="ttdeci">def test_fixtures(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00033">tests.py:33</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test_html_ae81a53ecfa55ca39401b3354f2390645"><div class="ttname"><a href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#ae81a53ecfa55ca39401b3354f2390645">django.contrib.gis.tests.geoapp.tests.GeoQuerySetTest.test_reverse_geom</a></div><div class="ttdeci">def test_reverse_geom(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00644">tests.py:644</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test_html_a0ab8d6a4d884a1bdc3882a113ff44817"><div class="ttname"><a href="../../d9/d8c/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_lookup_test.html#a0ab8d6a4d884a1bdc3882a113ff44817">django.contrib.gis.tests.geoapp.tests.GeoLookupTest.test_disjoint_lookup</a></div><div class="ttdeci">def test_disjoint_lookup(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00211">tests.py:211</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test_html_af17bc3acacbe5482df6c4110f830ff92"><div class="ttname"><a href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#af17bc3acacbe5482df6c4110f830ff92">django.contrib.gis.tests.geoapp.tests.GeoQuerySetTest.test_svg</a></div><div class="ttdeci">def test_svg(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00707">tests.py:707</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test_html_a6c06e978159b0663fd0c8012c84eb41b"><div class="ttname"><a href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#a6c06e978159b0663fd0c8012c84eb41b">django.contrib.gis.tests.geoapp.tests.GeoQuerySetTest.test_make_line</a></div><div class="ttdeci">def test_make_line(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00580">tests.py:580</a></div></div>
<div class="ttc" id="namespacedjango_1_1contrib_1_1gis_1_1tests_1_1utils_html"><div class="ttname"><a href="../../d1/d3d/namespacedjango_1_1contrib_1_1gis_1_1tests_1_1utils.html">django.contrib.gis.tests.utils</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d19/contrib_2gis_2tests_2utils_8py_source.html#l00001">utils.py:1</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test_html_aa8b5728eeb5e03f51f5ec6fa4161d9ad"><div class="ttname"><a href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#aa8b5728eeb5e03f51f5ec6fa4161d9ad">django.contrib.gis.tests.geoapp.tests.GeoQuerySetTest.test_scale</a></div><div class="ttdeci">def test_scale(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00656">tests.py:656</a></div></div>
<div class="ttc" id="namespacedjango_1_1db_html"><div class="ttname"><a href="../../df/df6/namespacedjango_1_1db.html">django.db</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d49/db_2____init_____8py_source.html#l00001">__init__.py:1</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test_html_a094d3322a5fae4bf18d6ce5f253e3af2"><div class="ttname"><a href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html#a094d3322a5fae4bf18d6ce5f253e3af2">django.contrib.gis.tests.geoapp.tests.GeoModelTest.test_createnull</a></div><div class="ttdeci">def test_createnull(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00153">tests.py:153</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1gdal_1_1geometries_1_1_o_g_r_geometry_html"><div class="ttname"><a href="../../dd/d78/classdjango_1_1contrib_1_1gis_1_1gdal_1_1geometries_1_1_o_g_r_geometry.html">django.contrib.gis.gdal.geometries.OGRGeometry</a></div><div class="ttdoc">OGRGeometry Class ####. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d2f/geometries_8py_source.html#l00071">geometries.py:71</a></div></div>
<div class="ttc" id="namespacedjango_1_1contrib_1_1gis_1_1geos_1_1factory_html_a07ad8dd2ccf181fd3dd033955cfc2c4c"><div class="ttname"><a href="../../df/d10/namespacedjango_1_1contrib_1_1gis_1_1geos_1_1factory.html#a07ad8dd2ccf181fd3dd033955cfc2c4c">django.contrib.gis.geos.factory.fromstr</a></div><div class="ttdeci">def fromstr(string, kwargs)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dbc/factory_8py_source.html#l00033">factory.py:33</a></div></div>
<div class="ttc" id="namespacedjango_1_1contrib_1_1gis_1_1geos_html"><div class="ttname"><a href="../../de/daf/namespacedjango_1_1contrib_1_1gis_1_1geos.html">django.contrib.gis.geos</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dbb/contrib_2gis_2geos_2____init_____8py_source.html#l00001">__init__.py:1</a></div></div>
<div class="ttc" id="namespacedjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_html_a3453fcc7624c80ae65cc95f9cc33eea4"><div class="ttname"><a href="../../dd/d52/namespacedjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests.html#a3453fcc7624c80ae65cc95f9cc33eea4">django.contrib.gis.tests.geoapp.tests.postgis_bug_version</a></div><div class="ttdeci">def postgis_bug_version()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00025">tests.py:25</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test_html_a1e335e98afec77917bc0772ddf3366a4"><div class="ttname"><a href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#a1e335e98afec77917bc0772ddf3366a4">django.contrib.gis.tests.geoapp.tests.GeoQuerySetTest.test_snap_to_grid</a></div><div class="ttdeci">def test_snap_to_grid(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00671">tests.py:671</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test_html_a75decd5e6b029f81f9ce68b2caff1297"><div class="ttname"><a href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#a75decd5e6b029f81f9ce68b2caff1297">django.contrib.gis.tests.geoapp.tests.GeoQuerySetTest.test_translate</a></div><div class="ttdeci">def test_translate(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00747">tests.py:747</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test_html_abea4956cd9d79668eb119ac5a871321d"><div class="ttname"><a href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#abea4956cd9d79668eb119ac5a871321d">django.contrib.gis.tests.geoapp.tests.GeoQuerySetTest.test_geohash</a></div><div class="ttdeci">def test_geohash(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00470">tests.py:470</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test_html_a4c5f497ce9675b81c7384ab9bd3df982"><div class="ttname"><a href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#a4c5f497ce9675b81c7384ab9bd3df982">django.contrib.gis.tests.geoapp.tests.GeoQuerySetTest.test_geojson</a></div><div class="ttdeci">def test_geojson(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00482">tests.py:482</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test_html_a53b2472041f463fe9e839f1e9e423a02"><div class="ttname"><a href="../../d7/d66/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_model_test.html#a53b2472041f463fe9e839f1e9e423a02">django.contrib.gis.tests.geoapp.tests.GeoModelTest.test_geometryfield</a></div><div class="ttdeci">def test_geometryfield(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00159">tests.py:159</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test_html_aae0bb17cd7adc32d938889c48bdd1214"><div class="ttname"><a href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#aae0bb17cd7adc32d938889c48bdd1214">django.contrib.gis.tests.geoapp.tests.GeoQuerySetTest.test_extent</a></div><div class="ttdeci">def test_extent(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00439">tests.py:439</a></div></div>
<div class="ttc" id="classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test_html_a5bcbc0af07dc22854e953d429ca18847"><div class="ttname"><a href="../../dc/d51/classdjango_1_1contrib_1_1gis_1_1tests_1_1geoapp_1_1tests_1_1_geo_query_set_test.html#a5bcbc0af07dc22854e953d429ca18847">django.contrib.gis.tests.geoapp.tests.GeoQuerySetTest.test_transform</a></div><div class="ttdeci">def test_transform(self)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py_source.html#l00723">tests.py:723</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_aafd3be6a177c495f3b9eb2737b2db84.html">dj16</a></li><li class="navelem"><a class="el" href="../../dir_838acba09077c42caf1d411f7f9b4112.html">lib</a></li><li class="navelem"><a class="el" href="../../dir_3ffcf0b4bee4b61965e9b1b8de28254b.html">python2.7</a></li><li class="navelem"><a class="el" href="../../dir_7e3ec870c5775d9c5a8b6a95e7426c4d.html">site-packages</a></li><li class="navelem"><a class="el" href="../../dir_23275a531fba6b9ef68c9e4339801e7f.html">django</a></li><li class="navelem"><a class="el" href="../../dir_36489e3d94cde229a0e6664698c5c034.html">contrib</a></li><li class="navelem"><a class="el" href="../../dir_acf2370672a69956ae062514dede3e58.html">gis</a></li><li class="navelem"><a class="el" href="../../dir_8482f46a41b6855c024a420e47eea0f6.html">tests</a></li><li class="navelem"><a class="el" href="../../dir_775d692b2c37f92d81fbd7710c49f378.html">geoapp</a></li><li class="navelem"><a class="el" href="../../df/dd8/contrib_2gis_2tests_2geoapp_2tests_8py.html">tests.py</a></li>
    <li class="footer">Generated on Tue Jan 20 2015 14:01:59 for Django by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
